- name: Upgrade packages
  become: true
  ansible.builtin.apt:
    install_recommends: false
    update_cache: true
    upgrade: dist
  notify: reboot

- name: Reboot if necessary
  ansible.builtin.meta: flush_handlers

- name: Clean up dependencies
  become: true
  ansible.builtin.apt:
    autoremove: true
    purge: true
  notify: reboot

- name: Reboot if necessary
  ansible.builtin.meta: flush_handlers

- name: Install extra packages
  become: true
  ansible.builtin.apt:
    install_recommends: false
    name: '{{ apt_extra_packages }}'
    state: present
